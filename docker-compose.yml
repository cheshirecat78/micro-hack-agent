# micro-hack remote agent - docker-compose
# 
# This docker-compose file allows you to run a micro-hack agent that connects
# to your micro-hack server and waits for commands.
#
# Setup:
# 1. Create an agent API key in micro-hack (Settings > Agents > Create Key)
# 2. Copy this file to your server
# 3. Edit the environment variables below
# 4. Run: docker-compose up -d
#
# The agent will automatically connect and appear in your micro-hack dashboard.

version: '3.8'

services:
  micro-hack-agent:
    # Public image from Docker Hub (supports amd64 and arm64)
    image: cheshirecat78/micro-hack-agent:latest
    container_name: micro-hack-agent
    restart: unless-stopped
    
    environment:
      # Required: Your micro-hack server WebSocket URL
      # Use wss:// for production (HTTPS), ws:// for local development
      - MICROHACK_SERVER_URL=${MICROHACK_SERVER_URL:-wss://app.micro-hack.nl}
      
      # Required: Your agent API key from micro-hack
      # Get this from: Settings > Agents > Create Key
      - MICROHACK_API_KEY=${MICROHACK_API_KEY:-mh_agent_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx}
    
    # Give the agent access to host network for full network scanning capabilities
    # This enables: SYN scans, OS detection, traceroute, scanning localhost, etc.
    network_mode: host
    
    # Optional: Mount volumes if the agent needs access to host files
    # volumes:
    #   - /var/log:/host/logs:ro
    
    # Optional: Resource limits
    # deploy:
    #   resources:
    #     limits:
    #       memory: 128M
    #       cpus: '0.5'

# Alternative: Run multiple agents
# services:
#   agent-server1:
#     image: cheshirecat78/micro-hack-agent:latest
#     environment:
#       - MICROHACK_SERVER_URL=wss://app.micro-hack.nl
#       - MICROHACK_API_KEY=mh_agent_key_for_server1
#
#   agent-server2:
#     image: cheshirecat78/micro-hack-agent:latest
#     environment:
#       - MICROHACK_SERVER_URL=wss://app.micro-hack.nl
#       - MICROHACK_API_KEY=mh_agent_key_for_server2
